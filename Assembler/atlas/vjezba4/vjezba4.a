CTCR EQU FFFF0000
CTLR EQU FFFF0004
CTSTAT EQU FFFF0008
CTGOTOV EQU FFFF000C

DMASRC EQU FFFF1000
DMADEST EQU FFFF1004
DMABROJAC EQU FFFF1008
DMACR EQU FFFF100C
DMASTART EQU FFFF1010
DMAPRIHVAT EQU FFFF1014

BVJ EQU FFFFFFFC


		ORG 0
		MOVE 10000, SP
		JP GLAVNI
		
		ORG 0C
		PUSH R0		;KONTEKST
		PUSH R1
		MOVE SR, R0
		PUSH R0
		
		STORE R0, (DMAPRIHVATI)
		
		LOAD R0, (ODREDISTE)	;STAVLJANJE PODATKA IZ BVJ NA ODREDISTE I
		ADD R0, %D 36, R0		;STAVLJANJE -1 NA TO MJESTO PA POMICANJE ODREDISTA ZA 4
		MOVE -1, R1
		STORE R1, (R0)
		ADD R0, 4, R0
		STORE R0, (ODREDISTE)
		
		LOAD R0, (BLOKOVI)
		ADD R0, 1, R0		;BROJAC BLOKOVA
		STORE R0, (BLOKOVI)
		
		POP R0
		MOVE R0, SR
		POP R1
		POP R0
		
		RETN		
		
		
GLAVNI	MOVE %D 1000, R0
		STORE R0, (CTLR)
		MOVE %B 001, R0
		STORE R0, (CTCR)
		
PETLJA	LOAD R0, (BLOKOVI)
		CMP R0, 5
		JR_EQ KRAJ

		LOAD R0, (CTSTAT)
		OR R0, R0, R0
		JR_Z PETLJA
		
		STORE R0, (CTSTAT)
		STORE R0, (CTGOTOV)
		
		
		MOVE 0FFFFFFFC, R0
		STORE R0, (DMASRC)
		LOAD R0, (ODREDISTE)
		STORE R0, (DMADEST)
		MOVE 9, R0
		STORE R0, (DMABROJAC)
		MOVE %B 0111, R0
		STORE R0, (DMACR)
		STORE R0, (DMASTART)
		JR PETLJA
		
				
KRAJ	MOVE 0, R0
		STORE R0, (CTCR)
		HALT



BLOKOVI DW 0
POM DW 900
ODREDISTE DW 1000

