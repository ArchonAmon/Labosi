		ORG 0
		MOV SP, #1<16
		
		MRS R0, CPSR
		BIC R0, R0, #80			;OMOGUCAVANJE PREKIDA
		MSR CPSR_C, R0

		B GLAVNI
		
		ORG 18
		B PREKID
		
		
GLAVNI 	LDR R3, GPIOADR		;ADRESA GPIO
		LDR R4, RTC			;ADRESA RTC
		
		LDR R2, TIME		;INICIJALIZACIJA RTC JEDINICE
		STR R2, [R4, #4]
		MOV R2, #1			;OMOGUCAVAJE PREKIDA RTC JEDINICE
		STR R2, [R4, #10]	
						
PETLJA	B PETLJA			;CEKANJE
	
		
		
		
PREKID	STMFD R13!, {R0, R1, R5, R6, R14}

		STR R4, [R4, #8]	;PRIHVACANJE PREKIDA
		MOV R1, #0
		STR R1, [R4, #0C]	;RESETIRANJE BROJILA
		
		MOV R0, #0D			;BRISANJE TRENUTNOG EKRANA
		BL LCDWR
		
		MOV R0, #3E			;ISPISIVANJE < 3 PUTA
		MOV R5, #3
		
ISPIS1	BL LCDWR
		SUBS R5, R5, #1
		BNE	ISPIS1
		
		
		LDR R1, INDEX		;ISPITIVANJE REDNOG BROJA ZNAKA KOJEGA TREBA STAVITI
		MOV R6, R1			;ISPITIVANJE INDEKSA ZA KASNIJE
		ADD R1, R1, #4<8
		LDR R0, [R1]
		MOV R1, R0			;STAVLJANJE R0 U R1 RADI KASNIJE PROVJERE
		BL LCDWR
		
		MOV R0, #3C			;ISPISIVANJE > 3 PUTA
		MOV R5, #3

ISPIS2	BL LCDWR
		SUBS R5, R5, #1
		BNE ISPIS2
		
		MOV R0, #0A			;ISPIS NA EKRAN
		BL LCDWR
	
	
		CMP R1, #0			;PROVJERA JE LI ZADNJI CLAN 0
		MOV R1, #0
		ADDNE R6, R6, #1	;POVACANJE INDEXA
		STRNE R6, INDEX
		STREQ R1, INDEX		;AKO JE ZADNJI CLAN 0, INDEKS POSTAJE 0
		
		
		LDMFD R13!, {R0, R1, R5, R6, R14}
		SUBS PC, LR, #4
		
		
LCDWR 	STMFD R13!, {R0}
		
		AND R0, R0, #7F			;SALJI ZNAK
		STRB R0, [R3, #4]
		
		ORR R0, R0, #80			;DIGNI IMPULS
		STRB R0, [R3, #4]
		
		AND R0, R0, #7F			;SPUSTI IMPULS
		STRB R0, [R3, #4]
		
		LDMFD R13!, {R0}		;KONTEKST
		MOV PC, LR
		
		
KRAJ 	SWI 123456

GPIOADR	DW FFFFFF00

TIME 	DW 256

RTC		DW FFFFFE00

INDEX	DW 0
		
		ORG 400
NIZ	    DB     49,6E,74,65,72,6E,61,74,69,6F,6E,61,6C,69,73,61,74,69,6F,6E,0 

